‚úÖ Loaded valid Tibber config
‚úÖ InfluxDB AI Service initialized
üîç Starting memory monitor...
InfluxDB client initialized
Generated User ID: user_5f33f1a5
‚úÖ Dynamic pricing cron jobs initialized
Attempting WebSocket connection (attempt 1/10)...
‚úÖ Warning service initialized
‚úÖ Telegram notification service initialized
‚úÖ Enhanced notification service initialized
üîÑ Initializing Tibber cache from InfluxDB...

üîã ========== ENHANCED DYNAMIC PRICING SYSTEM ==========
üîß Enhanced Features:
   ‚úÖ Intelligent Inverter Type Auto-Detection
   ‚úÖ Automatic Command Mapping (legacy ‚Üî new)
   ‚úÖ Enhanced Grid Charging Control
   ‚úÖ Smart Current Adjustment
   ‚úÖ Advanced Price Intelligence (Tibber)
   ‚úÖ Real-time Type Adaptation
   ‚úÖ Enhanced Logging & Status Reporting
   ‚úÖ Backward Compatibility
============================================================


üîã ========== TIBBER & AI CHARGING ==========
   ‚úÖ Tibber Price Integration
   ‚úÖ AI Charging Decisions
   ‚úÖ Real-time Monitoring
   ‚úÖ Automatic Optimization
==============================================

üöÄ CARBONOZ SolarAutopilot Server running on port 6789
üìä Monitoring 6 inverter(s) and 1 battery(ies)
üì° MQTT Topic Prefix: solar_assistant
üîç Inverter Type Detection: ACTIVE (auto-detects legacy, new, and hybrid)
üîÑ Auto-Setting Mapping: ENABLED (intelligent command translation)
üí° Learner Mode: INACTIVE
üîã Enhanced System: READY

üéØ Enhanced system ready to auto-detect and manage all inverter types!
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
üìä Querying InfluxDB for Tibber cache...
‚úÖ Loaded Tibber cache from InfluxDB: current price + 46 forecast points
‚úÖ Loaded Tibber cache from InfluxDB
Initializing data with inverter type support...
‚úÖ Existing pricing data is recent, no generation needed
Initializing data with inverter type support...
‚úÖ Existing pricing data is recent, no generation needed
‚úÖ Dynamic pricing integration initialized with intelligent inverter type support and automatic command mapping
‚úÖ System initialization complete with intelligent inverter type auto-detection support
WebSocket Error: Unexpected server response: 502
WebSocket closed with code 1006: . Reconnecting...
üîÑ Loading Tibber cache from InfluxDB...
‚ÑπÔ∏è  Tibber InfluxDB cache already loaded
üöÄ Initial price data refresh on startup...
Running scheduled pricing data refresh...
üîÑ Refreshing pricing data...
‚ÑπÔ∏è Tibber not properly configured: { enabled: true, hasApiKey: true, keyLength: 1 }
‚ÑπÔ∏è Using SMARD fallback
üìä Attempting SMARD API...
‚úÖ Scheduled data refresh completed

üìã ========== ENHANCED SYSTEM STATUS CHECK ==========
üîç Inverter Type Detection: Waiting for MQTT messages...
üóÑÔ∏è  InfluxDB Connection: ‚úÖ Connected
üì° MQTT Connection: ‚ùå Disconnected
======================================================

üéØ Enhanced System Ready!
   ‚Ä¢ Auto-detects and manages both legacy and new inverter types
   ‚Ä¢ Intelligently maps commands to appropriate MQTT topics
   ‚Ä¢ Maintains backward compatibility with existing systems
   ‚Ä¢ Delivers enhanced monitoring and control capabilities

Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Attempting WebSocket connection (attempt 2/10)...
WebSocket Error: Unexpected server response: 502
WebSocket closed with code 1006: . Reconnecting...
‚úÖ Saved 31 Tibber data points to InfluxDB
‚úÖ SMARD data refreshed successfully
‚úÖ Tibber price data refreshed automatically

ü©∫ === STARTUP DIAGNOSTICS ===

üîç === TIBBER DIAGNOSTIC ===
Config: {
  enabled: true,
  apiKey: '‚ö†Ô∏è  May be too short (1 chars)',
  homeId: 'none (optional - will use first home)',
  country: 'DE',
  timezone: 'Europe/Berlin',
  currency: 'EUR'
}

‚ÑπÔ∏è  Note: API key saved exactly as entered (no validation).
‚ÑπÔ∏è  Home ID is optional - will automatically use first available home if not set.
===========================


‚ÑπÔ∏è  Tibber not configured
   Configure at: /settings

ü§ñ AI Engine:
   - Initialized: false
   - MQTT: false
   - System State: true

======================================

Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Attempting WebSocket connection (attempt 3/10)...
WebSocket Error: WebSocket was closed before the connection was established
WebSocket closed with code 1006: . Reconnecting...
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
üîÑ Refreshing pricing data...
‚ÑπÔ∏è Tibber not properly configured: { enabled: true, hasApiKey: true, keyLength: 1 }
‚ÑπÔ∏è Using SMARD fallback
üìä Attempting SMARD API...
Attempting WebSocket connection (attempt 4/10)...
‚úÖ Saved 31 Tibber data points to InfluxDB
‚úÖ SMARD data refreshed successfully
WebSocket Error: WebSocket was closed before the connection was established
WebSocket closed with code 1006: . Reconnecting...
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Fetching analytics data for period: decade, timeRange: 3650d
Fetching analytics data for period: month, timeRange: 30d
Fetching analytics data for period: year, timeRange: 365d
Query for solar_assistant/total/grid_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_in/state (365d, 1d): 366 points
Query for solar_assistant/total/grid_energy_out/state (30d, 1d): 31 points
Query for solar_assistant/total/grid_energy_out/state (365d, 1d): 366 points
Query for solar_assistant/total/grid_energy_in/state (365d, 1d): 366 points
Query for solar_assistant/total/load_energy/state (365d, 1d): 366 points
Query for solar_assistant/total/battery_energy_out/state (3650d, 1d): 3651 points
Query for solar_assistant/total/pv_energy/state (365d, 1d): 366 points
Query for solar_assistant/total/load_energy/state (3650d, 1d): 3651 points
Query for solar_assistant/total/load_energy/state (30d, 1d): 31 points
Query for solar_assistant/total/pv_energy/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_out/state (30d, 1d): 31 points
Data lengths - Load: 31, PV: 31
Processing analytics - Grid data length: 31, PV data length: 31
Processed 31 analytics records for month
Fetching analytics data for period: month, timeRange: 30d
Query for solar_assistant/total/pv_energy/state (3650d, 1d): 3651 points
Query for solar_assistant/total/battery_energy_in/state (3650d, 1d): 3651 points
Query for solar_assistant/total/grid_energy_out/state (30d, 1d): 31 points
Query for solar_assistant/total/grid_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_out/state (30d, 1d): 31 points
Query for solar_assistant/total/grid_energy_in/state (3650d, 1d): 3651 points
Query for solar_assistant/total/battery_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/pv_energy/state (30d, 1d): 31 points
Query for solar_assistant/total/grid_energy_out/state (3650d, 1d): 3651 points
Data lengths - Load: 3651, PV: 3651
Processing analytics - Grid data length: 3651, PV data length: 3651
Processed 11 analytics records for decade
Query for solar_assistant/total/load_energy/state (30d, 1d): 31 points
Data lengths - Load: 31, PV: 31
Processing analytics - Grid data length: 31, PV data length: 31
Processed 31 analytics records for month
Query for solar_assistant/total/battery_energy_out/state (365d, 1d): 366 points
Data lengths - Load: 366, PV: 366
Processing analytics - Grid data length: 366, PV data length: 366
Processed 13 analytics records for year
Fetching analytics data for period: decade, timeRange: 3650d
Fetching analytics data for period: year, timeRange: 365d
Query for solar_assistant/total/grid_energy_out/state (365d, 1d): 366 points
Query for solar_assistant/total/battery_energy_out/state (3650d, 1d): 3651 points
Query for solar_assistant/total/grid_energy_in/state (365d, 1d): 366 points
Query for solar_assistant/total/battery_energy_in/state (365d, 1d): 366 points
Query for solar_assistant/total/pv_energy/state (365d, 1d): 366 points
Query for solar_assistant/total/load_energy/state (365d, 1d): 366 points
Query for solar_assistant/total/battery_energy_out/state (365d, 1d): 366 points
Data lengths - Load: 366, PV: 366
Processing analytics - Grid data length: 366, PV data length: 366
Processed 13 analytics records for year
Query for solar_assistant/total/load_energy/state (3650d, 1d): 3651 points
Query for solar_assistant/total/grid_energy_in/state (3650d, 1d): 3651 points
Query for solar_assistant/total/grid_energy_out/state (3650d, 1d): 3651 points
Query for solar_assistant/total/pv_energy/state (3650d, 1d): 3651 points
Query for solar_assistant/total/battery_energy_in/state (3650d, 1d): 3651 points
Data lengths - Load: 3651, PV: 3651
Processing analytics - Grid data length: 3651, PV data length: 3651
Processed 11 analytics records for decade
Attempting WebSocket connection (attempt 5/10)...
WebSocket Error: WebSocket was closed before the connection was established
WebSocket closed with code 1006: . Reconnecting...
Query for solar_assistant/total/grid_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/pv_energy/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_out/state (30d, 1d): 31 points
Query for solar_assistant/total/load_energy/state (30d, 1d): 31 points
Query for solar_assistant/total/grid_energy_out/state (30d, 1d): 31 points
Processing analytics - Grid data length: 31, PV data length: 31
Query for solar_assistant/total/grid_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/pv_energy/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_out/state (30d, 1d): 31 points
Query for solar_assistant/total/battery_energy_in/state (30d, 1d): 31 points
Query for solar_assistant/total/grid_energy_out/state (30d, 1d): 31 points
Query for solar_assistant/total/load_energy/state (30d, 1d): 31 points
Processing analytics - Grid data length: 31, PV data length: 31
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Attempting WebSocket connection (attempt 6/10)...
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
WebSocket Error: WebSocket was closed before the connection was established
WebSocket closed with code 1006: . Reconnecting...
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Failed to deliver notification to ui: TypeError: this.deliverToUI is not a function
    at NotificationService.deliverNotification (/Users/digitalaxis/Desktop/SolarAutopilotApp/services/notificationService.js:262:57)
    at NotificationService.processNotification (/Users/digitalaxis/Desktop/SolarAutopilotApp/services/notificationService.js:144:20)
    at /Users/digitalaxis/Desktop/SolarAutopilotApp/routes/notificationRoutes.js:157:51
    at Layer.handle [as handle_request] (/Users/digitalaxis/Desktop/SolarAutopilotApp/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/digitalaxis/Desktop/SolarAutopilotApp/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/digitalaxis/Desktop/SolarAutopilotApp/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/digitalaxis/Desktop/SolarAutopilotApp/node_modules/express/lib/router/layer.js:95:5)
    at /Users/digitalaxis/Desktop/SolarAutopilotApp/node_modules/express/lib/router/index.js:284:15
    at router.process_params (/Users/digitalaxis/Desktop/SolarAutopilotApp/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/digitalaxis/Desktop/SolarAutopilotApp/node_modules/express/lib/router/index.js:280:10)
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
üîá Notification suppressed: test_notification_test_system
üîá Notification suppressed: test_notification_test_system
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Attempting WebSocket connection (attempt 7/10)...
WebSocket Error: WebSocket was closed before the connection was established
WebSocket closed with code 1006: . Reconnecting...
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
Reconnecting to MQTT broker...
MQTT error: getaddrinfo ENOTFOUND homeassistant-andreas-raspberry.zebu-beaufort.ts.net
